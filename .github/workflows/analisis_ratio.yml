name: "Analizar Ratio Mensual de Vivos"

on:
  push:
    paths:
      - 'extractor/analizador_ratio_mes.py'
      - 'data/canales/**'
      - 'data/videos/**'
  workflow_dispatch: {}

jobs:
  analisis_ratio:
    name: Ejecutar AnÃ¡lisis de Ratio de Vivos
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout del repositorio
        uses: actions/checkout@v3

      - name: ğŸ Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: ğŸš€ Instalar dependencias
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      - name: ğŸ“‚ Asegurar carpeta de salida
        run: |
          echo "Creando carpeta data/informes si no existe..."
          mkdir -p data/informes

      - name: â–¶ï¸ Ejecutar script de anÃ¡lisis
        env:
          YOUTUBE_API_KEY: ${{ secrets.YOUTUBE_API_KEY }}
        run: |
          set -euxo pipefail
          echo "Iniciando anÃ¡lisis de ratio de vivos para el mes mÃ¡s reciente..."
          python extractor/analizador_ratio_mes.py
          echo "âœ… AnÃ¡lisis finalizado con Ã©xito."

      - name: ğŸ“¦ Subir reporte como artefacto
        if: ${{ success() }}
        uses: actions/upload-artifact@v4
        with:
          name: tabla-vivos-ratio
          path: data/informes/tabla_vivos_ratio_*.csv

      - name: âŒ Notificar error
        if: ${{ failure() }}
        run: |
          echo "âš ï¸ Ha ocurrido un error durante el anÃ¡lisis. Revisa los logs para mÃ¡s detalles."

